p8105_hw2_bx2232
================

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(lubridate)
library(readxl)
library(haven)
library(janitor)
```

    ## 
    ## Attaching package: 'janitor'
    ## 
    ## The following objects are masked from 'package:stats':
    ## 
    ##     chisq.test, fisher.test

``` r
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

\#Problem 1 \# pols-month

``` r
pols_df <- read_csv("fivethirtyeight_datasets/pols-month.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(
    year = as.integer(year),
    month = factor(month.name[as.integer(month)],
                   levels = month.name,
                   ordered = TRUE),
    president = case_when(
      prez_dem == 1 ~ "dem",
      prez_gop == 1 ~ "gop",
      TRUE ~ NA_character_
    )
  ) %>% 
  select(-prez_dem, -prez_gop, -day) %>% 
  select(year, month, everything())

pols_df
```

    ## # A tibble: 822 × 9
    ##     year month     gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president
    ##    <int> <ord>       <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>    
    ##  1  1947 January        23      51     253      23      45     198 dem      
    ##  2  1947 February       23      51     253      23      45     198 dem      
    ##  3  1947 March          23      51     253      23      45     198 dem      
    ##  4  1947 April          23      51     253      23      45     198 dem      
    ##  5  1947 May            23      51     253      23      45     198 dem      
    ##  6  1947 June           23      51     253      23      45     198 dem      
    ##  7  1947 July           23      51     253      23      45     198 dem      
    ##  8  1947 August         23      51     253      23      45     198 dem      
    ##  9  1947 September      23      51     253      23      45     198 dem      
    ## 10  1947 October        23      51     253      23      45     198 dem      
    ## # ℹ 812 more rows

\#snp

``` r
snp_df <- read_csv("fivethirtyeight_datasets/snp.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(
    year = as.integer(year),
    month = factor(month.name[as.integer(month)],
                   levels = month.name,
                   ordered = TRUE)
  ) %>% 
  select(year, month, close) %>% 
  arrange(year, month)

snp_df
```

    ## # A tibble: 787 × 3
    ##     year month close
    ##    <int> <ord> <dbl>
    ##  1    NA <NA>  2080.
    ##  2    NA <NA>  2063.
    ##  3    NA <NA>  2107.
    ##  4    NA <NA>  2086.
    ##  5    NA <NA>  2068.
    ##  6    NA <NA>  2104.
    ##  7    NA <NA>  1995.
    ##  8    NA <NA>  2059.
    ##  9    NA <NA>  2068.
    ## 10    NA <NA>  2018.
    ## # ℹ 777 more rows

\#unemployment

``` r
unemp_df <- read_csv("fivethirtyeight_datasets/unemployment.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    cols = -year,
    names_to = "month",
    values_to = "unemployment"
  ) %>% 
  mutate(
    year = as.integer(year),
    month = factor(
      month.name[match(month, tolower(month.abb))],
      levels = month.name,
      ordered = TRUE
    )
  ) %>% 
  arrange(year, month)

unemp_df
```

    ## # A tibble: 816 × 3
    ##     year month     unemployment
    ##    <int> <ord>            <dbl>
    ##  1  1948 January            3.4
    ##  2  1948 February           3.8
    ##  3  1948 March              4  
    ##  4  1948 April              3.9
    ##  5  1948 May                3.5
    ##  6  1948 June               3.6
    ##  7  1948 July               3.6
    ##  8  1948 August             3.9
    ##  9  1948 September          3.8
    ## 10  1948 October            3.7
    ## # ℹ 806 more rows

\#join all data together

``` r
merged_df <- pols_df %>% 
  left_join(snp_df,  by = c("year","month")) %>% 
  left_join(unemp_df, by = c("year","month")) %>% 
  arrange(year, month)

merged_df
```

    ## # A tibble: 822 × 11
    ##     year month   gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president close
    ##    <int> <ord>     <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>     <dbl>
    ##  1  1947 January      23      51     253      23      45     198 dem          NA
    ##  2  1947 Februa…      23      51     253      23      45     198 dem          NA
    ##  3  1947 March        23      51     253      23      45     198 dem          NA
    ##  4  1947 April        23      51     253      23      45     198 dem          NA
    ##  5  1947 May          23      51     253      23      45     198 dem          NA
    ##  6  1947 June         23      51     253      23      45     198 dem          NA
    ##  7  1947 July         23      51     253      23      45     198 dem          NA
    ##  8  1947 August       23      51     253      23      45     198 dem          NA
    ##  9  1947 Septem…      23      51     253      23      45     198 dem          NA
    ## 10  1947 October      23      51     253      23      45     198 dem          NA
    ## # ℹ 812 more rows
    ## # ℹ 1 more variable: unemployment <dbl>

``` r
summary(pols_df)
```

    ##       year           month        gov_gop         sen_gop        rep_gop     
    ##  Min.   :1947   January : 69   Min.   :12.00   Min.   :32.0   Min.   :141.0  
    ##  1st Qu.:1964   February: 69   1st Qu.:18.00   1st Qu.:42.0   1st Qu.:176.0  
    ##  Median :1981   March   : 69   Median :22.00   Median :46.0   Median :195.0  
    ##  Mean   :1981   April   : 69   Mean   :22.48   Mean   :46.1   Mean   :194.9  
    ##  3rd Qu.:1998   May     : 69   3rd Qu.:28.00   3rd Qu.:51.0   3rd Qu.:222.0  
    ##  Max.   :2015   June    : 69   Max.   :34.00   Max.   :56.0   Max.   :253.0  
    ##                 (Other) :408                                                 
    ##     gov_dem        sen_dem         rep_dem     president        
    ##  Min.   :17.0   Min.   :44.00   Min.   :188   Length:822        
    ##  1st Qu.:22.0   1st Qu.:48.00   1st Qu.:211   Class :character  
    ##  Median :28.0   Median :53.00   Median :250   Mode  :character  
    ##  Mean   :27.2   Mean   :54.41   Mean   :245                     
    ##  3rd Qu.:32.0   3rd Qu.:58.00   3rd Qu.:268                     
    ##  Max.   :41.0   Max.   :71.00   Max.   :301                     
    ## 

``` r
summary(snp_df)
```

    ##       year          month         close        
    ##  Min.   : NA   January :  0   Min.   :  17.05  
    ##  1st Qu.: NA   February:  0   1st Qu.:  83.73  
    ##  Median : NA   March   :  0   Median : 138.53  
    ##  Mean   :NaN   April   :  0   Mean   : 474.89  
    ##  3rd Qu.: NA   May     :  0   3rd Qu.: 941.80  
    ##  Max.   : NA   (Other) :  0   Max.   :2107.39  
    ##  NA's   :787   NA's    :787

``` r
summary(unemp_df)
```

    ##       year           month      unemployment  
    ##  Min.   :1948   January : 68   Min.   : 2.50  
    ##  1st Qu.:1965   February: 68   1st Qu.: 4.70  
    ##  Median :1982   March   : 68   Median : 5.60  
    ##  Mean   :1982   April   : 68   Mean   : 5.83  
    ##  3rd Qu.:1998   May     : 68   3rd Qu.: 6.90  
    ##  Max.   :2015   June    : 68   Max.   :10.80  
    ##                 (Other) :408   NA's   :6

``` r
summary(merged_df)
```

    ##       year           month        gov_gop         sen_gop        rep_gop     
    ##  Min.   :1947   January : 69   Min.   :12.00   Min.   :32.0   Min.   :141.0  
    ##  1st Qu.:1964   February: 69   1st Qu.:18.00   1st Qu.:42.0   1st Qu.:176.0  
    ##  Median :1981   March   : 69   Median :22.00   Median :46.0   Median :195.0  
    ##  Mean   :1981   April   : 69   Mean   :22.48   Mean   :46.1   Mean   :194.9  
    ##  3rd Qu.:1998   May     : 69   3rd Qu.:28.00   3rd Qu.:51.0   3rd Qu.:222.0  
    ##  Max.   :2015   June    : 69   Max.   :34.00   Max.   :56.0   Max.   :253.0  
    ##                 (Other) :408                                                 
    ##     gov_dem        sen_dem         rep_dem     president             close    
    ##  Min.   :17.0   Min.   :44.00   Min.   :188   Length:822         Min.   : NA  
    ##  1st Qu.:22.0   1st Qu.:48.00   1st Qu.:211   Class :character   1st Qu.: NA  
    ##  Median :28.0   Median :53.00   Median :250   Mode  :character   Median : NA  
    ##  Mean   :27.2   Mean   :54.41   Mean   :245                      Mean   :NaN  
    ##  3rd Qu.:32.0   3rd Qu.:58.00   3rd Qu.:268                      3rd Qu.: NA  
    ##  Max.   :41.0   Max.   :71.00   Max.   :301                      Max.   : NA  
    ##                                                                  NA's   :822  
    ##   unemployment  
    ##  Min.   : 2.50  
    ##  1st Qu.: 4.70  
    ##  Median : 5.60  
    ##  Mean   : 5.83  
    ##  3rd Qu.: 6.90  
    ##  Max.   :10.80  
    ##  NA's   :12

\#Problem 2 \# Mr. Trash Wheel

``` r
mr_df <- readxl::read_excel(
  "202509 Trash Wheel Collection Data.xlsx",
  sheet = "Mr. Trash Wheel",
  range = readxl::cell_limits(ul = c(2, 1), lr = c(NA, NA))
) %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(
    date = as.Date(date),
    year = as.integer(lubridate::year(date)),
    month = factor(
      month.name[lubridate::month(date)],
      levels = month.name,
      ordered = TRUE
    ),
    sports_balls = as.integer(round(sports_balls)),
    wheel = "Mr"
  ) %>% 
  select(wheel, dumpster, date, year, month, everything())

mr_df
```

    ## # A tibble: 707 × 17
    ##    wheel dumpster date        year month weight_tons volume_cubic_yards
    ##    <chr>    <dbl> <date>     <int> <ord>       <dbl>              <dbl>
    ##  1 Mr           1 2014-05-16  2014 May          4.31                 18
    ##  2 Mr           2 2014-05-16  2014 May          2.74                 13
    ##  3 Mr           3 2014-05-16  2014 May          3.45                 15
    ##  4 Mr           4 2014-05-17  2014 May          3.1                  15
    ##  5 Mr           5 2014-05-17  2014 May          4.06                 18
    ##  6 Mr           6 2014-05-20  2014 May          2.71                 13
    ##  7 Mr           7 2014-05-21  2014 May          1.91                  8
    ##  8 Mr           8 2014-05-28  2014 May          3.7                  16
    ##  9 Mr           9 2014-06-05  2014 June         2.52                 14
    ## 10 Mr          10 2014-06-11  2014 June         3.76                 18
    ## # ℹ 697 more rows
    ## # ℹ 10 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, sports_balls <int>, homes_powered <dbl>, x15 <lgl>,
    ## #   x16 <lgl>

# Professor Trash Wheel

``` r
prof_df <- readxl::read_excel(
  "202509 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  range = readxl::cell_limits(ul = c(2, 1), lr = c(NA, NA))
) %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    date  = as.Date(date),
    year  = as.integer(lubridate::year(date)),
    month = factor(month.name[lubridate::month(date)], levels = month.name, ordered = TRUE),
    wheel = "Professor"
  ) %>%
  select(wheel, dumpster, date, year, month, everything())

prof_df
```

    ## # A tibble: 132 × 14
    ##    wheel     dumpster date        year month    weight_tons volume_cubic_yards
    ##    <chr>        <dbl> <date>     <int> <ord>          <dbl>              <dbl>
    ##  1 Professor        1 2017-01-02  2017 January         1.79                 15
    ##  2 Professor        2 2017-01-30  2017 January         1.58                 15
    ##  3 Professor        3 2017-02-26  2017 February        2.32                 18
    ##  4 Professor        4 2017-02-26  2017 February        3.72                 15
    ##  5 Professor        5 2017-02-28  2017 February        1.45                 15
    ##  6 Professor        6 2017-03-30  2017 March           1.71                 15
    ##  7 Professor        7 2017-04-01  2017 April           1.82                 15
    ##  8 Professor        8 2017-04-20  2017 April           2.37                 15
    ##  9 Professor        9 2017-05-10  2017 May             2.64                 15
    ## 10 Professor       10 2017-05-26  2017 May             2.78                 15
    ## # ℹ 122 more rows
    ## # ℹ 7 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, homes_powered <dbl>

\#Gwynns Falls Trash Wheel

``` r
gwyn_df <- readxl::read_excel(
  "202509 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynns Falls Trash Wheel",
  range = readxl::cell_limits(ul = c(2, 1), lr = c(NA, NA))
) %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(
    date = as.Date(date),
    year = as.integer(lubridate::year(date)),
    month = factor(month.name[lubridate::month(date)], levels = month.name, ordered = TRUE),
    sports_balls = if ("sports_balls" %in% names(.)) as.integer(round(sports_balls)) else NA_integer_,
    wheel = "Gwynns Falls Trash Wheel"
  ) %>% 
  select(wheel, dumpster, date, year, month, everything())

gwyn_df
```

    ## # A tibble: 349 × 14
    ##    wheel          dumpster date        year month weight_tons volume_cubic_yards
    ##    <chr>             <dbl> <date>     <int> <ord>       <dbl>              <dbl>
    ##  1 Gwynns Falls …        1 2021-07-03  2021 July         0.93                 15
    ##  2 Gwynns Falls …        2 2021-07-07  2021 July         2.26                 15
    ##  3 Gwynns Falls …        3 2021-07-07  2021 July         1.62                 15
    ##  4 Gwynns Falls …        4 2021-07-16  2021 July         1.76                 15
    ##  5 Gwynns Falls …        5 2021-07-30  2021 July         1.53                 15
    ##  6 Gwynns Falls …        6 2021-08-11  2021 Augu…        2.06                 15
    ##  7 Gwynns Falls …        7 2021-08-14  2021 Augu…        1.9                  15
    ##  8 Gwynns Falls …        8 2021-08-16  2021 Augu…        2.16                 15
    ##  9 Gwynns Falls …        9 2021-08-16  2021 Augu…        2.6                  15
    ## 10 Gwynns Falls …       10 2021-08-17  2021 Augu…        3.21                 15
    ## # ℹ 339 more rows
    ## # ℹ 7 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, plastic_bags <dbl>, wrappers <dbl>,
    ## #   homes_powered <dbl>, sports_balls <int>

``` r
trash_df <- dplyr::bind_rows(mr_df, prof_df, gwyn_df) |>
  dplyr::arrange(wheel, date) |>
  dplyr::select(wheel, dumpster, date, year, month, dplyr::everything())
```

``` r
prof_total_weight <- trash_df |>
  dplyr::filter(wheel == "Professor") |>
  dplyr::summarise(total_weight_tons = sum(weight_tons, na.rm = TRUE)) |>
  dplyr::pull(total_weight_tons)

gwyn_cigs_jun2022 <- trash_df |>
  dplyr::filter(wheel == "Gwynnda", year == 2022, month == "June") |>
  dplyr::summarise(total_cig_butts = sum(cigarette_butts, na.rm = TRUE)) |>
  dplyr::pull(total_cig_butts)
```

The combined Trash Wheel dataset contains 1188 observations across 3
wheels (Gwynns Falls Trash Wheel, Mr, Professor). Key variables include
dumpster, date, year, month, weight_tons, volume_cubic_yards,
plastic_bottles, polystyrene, cigarette_butts, sports_balls. For
available data, Professor Trash Wheel has collected a total of 282.3
tons of trash. Gwynnda collected 0 cigarette butts in June 2022.

\#problem 3

``` r
zip_map <- read_csv("zillow_data/Zip Codes.csv") %>%
  clean_names() %>%
  mutate(zip_code = as.character(zip_code))

zori_wide <- read_csv("zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>%
  clean_names() %>%
  rename(zip_code = region_name) %>%
  mutate(zip_code = as.character(zip_code))

glimpse(zip_map)
```

    ## Rows: 322
    ## Columns: 7
    ## $ county       <chr> "Bronx", "Bronx", "Bronx", "Bronx", "Bronx", "Bronx", "Br…
    ## $ state_fips   <dbl> 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 3…
    ## $ county_code  <chr> "005", "005", "005", "005", "005", "005", "005", "005", "…
    ## $ county_fips  <dbl> 36005, 36005, 36005, 36005, 36005, 36005, 36005, 36005, 3…
    ## $ zip_code     <chr> "10451", "10452", "10453", "10454", "10455", "10456", "10…
    ## $ file_date    <chr> "7/25/07", "7/25/07", "7/25/07", "7/25/07", "7/25/07", "7…
    ## $ neighborhood <chr> "High Bridge and Morrisania", "High Bridge and Morrisania…

``` r
glimpse(zori_wide)
```

    ## Rows: 149
    ## Columns: 125
    ## $ region_id   <dbl> 62080, 62093, 62019, 62046, 61807, 62085, 62037, 62018, 61…
    ## $ size_rank   <dbl> 4, 7, 9, 16, 17, 18, 19, 20, 29, 32, 36, 39, 40, 43, 47, 4…
    ## $ zip_code    <chr> "11368", "11385", "11208", "11236", "10467", "11373", "112…
    ## $ region_type <chr> "zip", "zip", "zip", "zip", "zip", "zip", "zip", "zip", "z…
    ## $ state_name  <chr> "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY"…
    ## $ state       <chr> "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY"…
    ## $ city        <chr> "New York", "New York", "New York", "New York", "New York"…
    ## $ metro       <chr> "New York-Newark-Jersey City, NY-NJ-PA", "New York-Newark-…
    ## $ county_name <chr> "Queens County", "Queens County", "Kings County", "Kings C…
    ## $ x2015_01_31 <dbl> NA, NA, NA, NA, NA, NA, 1919.726, 1943.311, 3054.576, NA, …
    ## $ x2015_02_28 <dbl> NA, NA, NA, NA, NA, NA, 1947.088, 1851.295, 3053.302, NA, …
    ## $ x2015_03_31 <dbl> NA, NA, NA, NA, NA, NA, 2038.567, 1851.512, 3049.818, NA, …
    ## $ x2015_04_30 <dbl> NA, NA, NA, NA, NA, NA, 2041.355, 1876.733, 3073.585, NA, …
    ## $ x2015_05_31 <dbl> NA, NA, NA, NA, NA, NA, 2053.751, 1972.097, 3093.156, NA, …
    ## $ x2015_06_30 <dbl> NA, NA, NA, NA, NA, NA, 2033.709, 2025.955, 3120.443, NA, …
    ## $ x2015_07_31 <dbl> NA, NA, NA, NA, NA, NA, 2056.747, 2034.935, 3130.740, NA, …
    ## $ x2015_08_31 <dbl> NA, NA, NA, NA, NA, NA, 2071.559, 2016.905, 3128.406, NA, …
    ## $ x2015_09_30 <dbl> NA, NA, NA, NA, NA, NA, 2092.795, 2046.119, 3125.705, NA, …
    ## $ x2015_10_31 <dbl> NA, NA, NA, NA, NA, NA, 2093.826, 2052.770, 3126.853, NA, …
    ## $ x2015_11_30 <dbl> NA, NA, NA, NA, NA, NA, 2095.349, 2108.550, 3129.706, NA, …
    ## $ x2015_12_31 <dbl> NA, NA, NA, NA, NA, NA, 2088.164, 2062.484, 3125.624, NA, …
    ## $ x2016_01_31 <dbl> NA, NA, NA, NA, NA, NA, 2089.653, 2068.113, 3115.547, NA, …
    ## $ x2016_02_29 <dbl> NA, NA, NA, NA, NA, NA, 2082.460, 2075.443, 3111.635, NA, …
    ## $ x2016_03_31 <dbl> NA, NA, NA, NA, NA, NA, 2131.828, 2166.531, 3126.976, NA, …
    ## $ x2016_04_30 <dbl> NA, NA, NA, NA, NA, NA, 2151.524, 2198.191, 3134.421, NA, …
    ## $ x2016_05_31 <dbl> NA, 2266.140, NA, NA, 1349.679, NA, 2171.467, 2163.246, 31…
    ## $ x2016_06_30 <dbl> NA, 2292.023, NA, NA, 1327.656, NA, 2195.605, 2134.050, 31…
    ## $ x2016_07_31 <dbl> NA, 2320.788, NA, NA, 1351.738, NA, 2235.378, 2125.281, 31…
    ## $ x2016_08_31 <dbl> NA, 2343.339, NA, NA, 1313.098, NA, 2240.782, 2149.885, 32…
    ## $ x2016_09_30 <dbl> NA, 2337.120, NA, NA, 1331.150, NA, 2202.912, 2132.201, 32…
    ## $ x2016_10_31 <dbl> NA, 2345.339, NA, NA, 1317.193, NA, 2175.157, 2131.459, 31…
    ## $ x2016_11_30 <dbl> NA, 2320.083, NA, NA, 1307.569, NA, 2203.503, 2144.048, 31…
    ## $ x2016_12_31 <dbl> NA, 2326.450, NA, NA, 1294.087, NA, 2220.357, 2150.612, 30…
    ## $ x2017_01_31 <dbl> NA, 2310.855, NA, NA, 1354.713, NA, 2230.477, 2149.877, 30…
    ## $ x2017_02_28 <dbl> NA, 2313.101, NA, NA, 1381.230, NA, 2222.774, 2119.797, 30…
    ## $ x2017_03_31 <dbl> NA, 2316.134, NA, NA, 1443.584, NA, 2227.372, 2114.796, 30…
    ## $ x2017_04_30 <dbl> NA, 2309.757, NA, NA, 1427.754, NA, 2217.893, 2124.847, 31…
    ## $ x2017_05_31 <dbl> NA, 2336.220, NA, NA, NA, NA, 2224.578, 2113.990, 3146.901…
    ## $ x2017_06_30 <dbl> NA, 2327.477, NA, NA, 1419.295, NA, 2246.103, 2110.918, 31…
    ## $ x2017_07_31 <dbl> NA, 2349.503, NA, NA, 1427.326, NA, 2268.897, 2113.950, 32…
    ## $ x2017_08_31 <dbl> NA, 2354.110, NA, NA, 1391.902, NA, 2266.585, 2154.685, 32…
    ## $ x2017_09_30 <dbl> NA, 2393.023, NA, NA, 1388.167, NA, 2253.781, 2190.012, 32…
    ## $ x2017_10_31 <dbl> NA, 2363.952, NA, NA, 1402.915, NA, 2233.249, 2209.270, 31…
    ## $ x2017_11_30 <dbl> NA, 2360.901, NA, NA, 1443.141, NA, 2214.707, 2197.699, 31…
    ## $ x2017_12_31 <dbl> NA, 2336.269, NA, NA, 1448.317, NA, 2203.283, 2195.972, 30…
    ## $ x2018_01_31 <dbl> NA, 2331.220, NA, NA, 1415.071, NA, 2212.000, 2173.922, 30…
    ## $ x2018_02_28 <dbl> NA, 2314.654, NA, NA, 1447.512, NA, 2242.629, 2161.329, 30…
    ## $ x2018_03_31 <dbl> NA, 2317.821, NA, NA, 1475.749, NA, 2265.593, 2164.720, 30…
    ## $ x2018_04_30 <dbl> NA, 2337.118, NA, NA, 1550.592, NA, 2292.588, 2225.315, 31…
    ## $ x2018_05_31 <dbl> NA, 2352.811, NA, NA, 1557.876, NA, 2295.173, 2250.959, 31…
    ## $ x2018_06_30 <dbl> NA, 2362.330, NA, NA, 1554.092, NA, 2304.912, 2259.032, 32…
    ## $ x2018_07_31 <dbl> NA, 2367.660, NA, NA, 1551.874, NA, 2320.557, 2230.589, 32…
    ## $ x2018_08_31 <dbl> NA, 2376.613, NA, NA, 1552.840, NA, 2349.465, 2259.636, 32…
    ## $ x2018_09_30 <dbl> NA, 2380.886, NA, NA, 1580.368, NA, 2369.397, 2260.747, 32…
    ## $ x2018_10_31 <dbl> NA, 2402.277, NA, NA, 1576.065, NA, 2351.768, 2241.267, 32…
    ## $ x2018_11_30 <dbl> NA, 2393.917, NA, NA, 1554.715, NA, 2334.290, 2241.702, 32…
    ## $ x2018_12_31 <dbl> NA, 2397.149, NA, NA, 1593.641, NA, 2306.881, 2241.726, 32…
    ## $ x2019_01_31 <dbl> NA, 2374.795, NA, NA, 1588.411, NA, 2322.166, 2267.492, 32…
    ## $ x2019_02_28 <dbl> NA, 2397.457, NA, NA, 1600.744, NA, 2310.874, 2262.747, 32…
    ## $ x2019_03_31 <dbl> NA, 2381.838, NA, NA, 1578.046, NA, 2337.374, 2300.330, 31…
    ## $ x2019_04_30 <dbl> NA, 2398.852, NA, NA, 1572.738, NA, 2320.309, 2282.050, 32…
    ## $ x2019_05_31 <dbl> NA, 2381.123, NA, NA, 1587.081, NA, 2348.144, 2312.998, 32…
    ## $ x2019_06_30 <dbl> NA, 2440.723, NA, NA, 1568.751, NA, 2347.740, 2308.482, 33…
    ## $ x2019_07_31 <dbl> NA, 2471.034, NA, NA, 1613.196, NA, 2377.157, 2344.878, 33…
    ## $ x2019_08_31 <dbl> NA, 2495.005, NA, NA, 1620.662, NA, 2401.689, 2341.534, 33…
    ## $ x2019_09_30 <dbl> NA, 2476.095, NA, NA, 1685.971, NA, 2419.742, 2348.960, 33…
    ## $ x2019_10_31 <dbl> NA, 2464.924, NA, NA, 1699.779, NA, 2413.602, 2356.870, 33…
    ## $ x2019_11_30 <dbl> NA, 2488.450, NA, NA, 1695.050, NA, 2378.537, 2385.016, 33…
    ## $ x2019_12_31 <dbl> NA, 2498.628, NA, NA, 1669.128, NA, 2348.024, 2409.248, 32…
    ## $ x2020_01_31 <dbl> NA, 2509.859, NA, NA, 1649.561, NA, 2357.056, 2418.346, 32…
    ## $ x2020_02_29 <dbl> NA, 2515.646, NA, NA, 1665.102, NA, 2354.012, 2406.290, 33…
    ## $ x2020_03_31 <dbl> NA, 2501.732, NA, NA, 1668.471, NA, 2390.353, 2384.940, 33…
    ## $ x2020_04_30 <dbl> NA, 2475.083, NA, NA, 1653.317, NA, 2384.131, 2397.553, 32…
    ## $ x2020_05_31 <dbl> NA, 2475.563, NA, NA, 1612.794, NA, 2394.843, 2400.946, 32…
    ## $ x2020_06_30 <dbl> NA, 2469.365, NA, NA, 1598.750, NA, 2372.863, 2390.648, 31…
    ## $ x2020_07_31 <dbl> NA, 2475.826, NA, NA, 1655.226, NA, 2375.547, 2357.104, 31…
    ## $ x2020_08_31 <dbl> NA, 2427.843, NA, NA, 1699.814, NA, 2352.791, 2326.858, 30…
    ## $ x2020_09_30 <dbl> NA, 2401.526, NA, NA, 1745.707, NA, 2321.016, 2270.901, 29…
    ## $ x2020_10_31 <dbl> NA, 2368.533, NA, NA, 1724.810, NA, 2286.740, 2224.135, 28…
    ## $ x2020_11_30 <dbl> NA, 2337.224, NA, NA, 1774.450, NA, 2268.131, 2167.380, 28…
    ## $ x2020_12_31 <dbl> NA, 2305.878, NA, NA, 1725.417, NA, 2223.454, 2164.536, 27…
    ## $ x2021_01_31 <dbl> NA, 2292.884, NA, NA, 1744.514, NA, 2180.768, 2142.852, 27…
    ## $ x2021_02_28 <dbl> NA, 2277.712, NA, NA, 1701.264, NA, 2182.021, 2121.733, 28…
    ## $ x2021_03_31 <dbl> NA, 2282.339, NA, NA, 1737.235, NA, 2209.309, 2102.816, 28…
    ## $ x2021_04_30 <dbl> NA, 2278.929, NA, NA, 1690.341, 1872.391, 2254.320, 2111.9…
    ## $ x2021_05_31 <dbl> NA, 2322.021, NA, NA, 1715.512, 1875.980, 2278.554, 2191.8…
    ## $ x2021_06_30 <dbl> NA, 2368.377, NA, NA, 1725.934, 1908.656, 2310.224, 2261.8…
    ## $ x2021_07_31 <dbl> NA, 2420.586, NA, NA, 1751.695, 1930.109, 2349.893, 2316.8…
    ## $ x2021_08_31 <dbl> NA, 2449.848, NA, NA, 1742.938, 1949.615, 2367.497, 2336.2…
    ## $ x2021_09_30 <dbl> NA, 2482.230, NA, NA, 1772.303, 1966.494, 2398.880, 2364.1…
    ## $ x2021_10_31 <dbl> NA, 2518.714, NA, NA, 1807.374, 1910.506, 2397.910, 2412.8…
    ## $ x2021_11_30 <dbl> NA, 2556.784, NA, NA, 1812.226, 1934.053, 2409.960, 2413.5…
    ## $ x2021_12_31 <dbl> NA, 2580.724, NA, NA, 1747.475, 1923.586, 2411.932, 2448.9…
    ## $ x2022_01_31 <dbl> NA, 2592.727, NA, NA, 1728.976, 1927.948, 2437.651, 2452.6…
    ## $ x2022_02_28 <dbl> NA, 2591.473, NA, NA, 1785.026, 1969.994, 2473.804, 2473.5…
    ## $ x2022_03_31 <dbl> NA, 2607.010, 2432.634, NA, 1831.988, 2023.199, 2515.255, …
    ## $ x2022_04_30 <dbl> NA, 2657.466, 2468.666, NA, 1886.640, 2100.825, 2547.030, …
    ## $ x2022_05_31 <dbl> NA, 2727.357, 2553.099, 2328.869, 1881.483, 2107.368, 2591…
    ## $ x2022_06_30 <dbl> NA, 2830.789, 2571.974, 2376.032, 1904.170, 2138.288, 2641…
    ## $ x2022_07_31 <dbl> NA, 2893.427, 2541.777, 2347.321, 1937.096, 2166.511, 2678…
    ## $ x2022_08_31 <dbl> NA, 2951.086, 2549.192, 2400.155, 1944.353, 2151.894, 2685…
    ## $ x2022_09_30 <dbl> NA, 2957.775, 2533.571, 2397.660, 1931.878, 2144.004, 2685…
    ## $ x2022_10_31 <dbl> NA, 2966.494, 2596.307, 2524.344, 1893.956, 2141.909, 2692…
    ## $ x2022_11_30 <dbl> NA, 2937.695, 2624.750, 2502.490, 1891.447, 2163.435, 2686…
    ## $ x2022_12_31 <dbl> NA, 2898.732, 2660.759, 2582.495, 1899.311, 2181.641, 2657…
    ## $ x2023_01_31 <dbl> NA, 2851.205, 2683.873, 2432.282, 1929.648, 2213.842, 2651…
    ## $ x2023_02_28 <dbl> NA, 2847.664, 2685.560, 2429.336, 1945.849, 2226.211, 2646…
    ## $ x2023_03_31 <dbl> NA, 2865.429, 2657.591, 2391.820, 1958.650, 2214.526, 2676…
    ## $ x2023_04_30 <dbl> NA, 2908.589, 2672.800, 2451.315, 1909.791, 2217.911, 2681…
    ## $ x2023_05_31 <dbl> NA, 2950.697, 2699.051, 2501.957, 1963.970, 2218.745, 2706…
    ## $ x2023_06_30 <dbl> NA, 2986.174, 2825.592, 2598.722, 2049.137, 2253.525, 2728…
    ## $ x2023_07_31 <dbl> NA, 3004.259, 2817.253, 2642.102, 2084.984, 2261.120, 2748…
    ## $ x2023_08_31 <dbl> NA, 3021.107, 2797.145, 2672.396, 2100.269, 2295.725, 2757…
    ## $ x2023_09_30 <dbl> NA, 3039.225, 2773.578, 2715.256, 2182.744, 2275.544, 2743…
    ## $ x2023_10_31 <dbl> NA, 3042.726, 2815.385, 2700.885, 2238.053, 2302.135, 2722…
    ## $ x2023_11_30 <dbl> NA, 3022.294, 2934.593, 2743.458, 2317.342, 2293.275, 2713…
    ## $ x2023_12_31 <dbl> NA, 2985.509, 2977.254, 2753.950, 2243.914, 2290.069, 2716…
    ## $ x2024_01_31 <dbl> NA, 2976.598, 3015.684, 2848.811, 2269.451, 2283.986, 2745…
    ## $ x2024_02_29 <dbl> NA, 2971.280, 2987.130, 2899.215, 2233.032, 2273.511, 2741…
    ## $ x2024_03_31 <dbl> NA, 3022.816, 2963.105, 2977.176, 2244.841, 2281.456, 2737…
    ## $ x2024_04_30 <dbl> NA, 3032.851, 2895.445, 2935.365, 2303.026, 2302.458, 2726…
    ## $ x2024_05_31 <dbl> NA, 3102.032, 2817.406, 2959.498, 2282.180, 2377.143, 2750…
    ## $ x2024_06_30 <dbl> NA, 3132.088, 2858.719, 2847.246, 2309.057, 2439.551, 2766…
    ## $ x2024_07_31 <dbl> 2322.418, 3203.117, 2816.037, 2862.954, 2294.031, 2491.626…
    ## $ x2024_08_31 <dbl> 2282.500, 3199.751, 2895.667, 2976.389, 2271.611, 2476.333…

``` r
zori_long <- zori_wide %>%
  pivot_longer(
    cols = starts_with("x20"),
    names_to = "date_str",
    values_to = "rent_index"
  ) %>%
  mutate(
    date_str = gsub("^x", "", date_str),    # remove "x"
    date_str = gsub("_", "-", date_str),    # turn underscores to dashes
    date = ymd(date_str),
    year = year(date),
    month = month(date)                     # numeric month (1 = Jan)
  ) %>%
  select(zip_code, year, month, date, rent_index)

glimpse(zori_long)
```

    ## Rows: 17,284
    ## Columns: 5
    ## $ zip_code   <chr> "11368", "11368", "11368", "11368", "11368", "11368", "1136…
    ## $ year       <dbl> 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015,…
    ## $ month      <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7,…
    ## $ date       <date> 2015-01-31, 2015-02-28, 2015-03-31, 2015-04-30, 2015-05-31…
    ## $ rent_index <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…

``` r
tidy_df <- zori_long %>%
  left_join(zip_map, by = "zip_code")
```

``` r
list(
  total_observations   = nrow(tidy_df),
  unique_zip_codes     = n_distinct(tidy_df$zip_code),
  unique_neighborhoods = n_distinct(na.omit(tidy_df$neighborhood))
)
```

    ## $total_observations
    ## [1] 17516
    ## 
    ## $unique_zip_codes
    ## [1] 149
    ## 
    ## $unique_neighborhoods
    ## [1] 42

``` r
setdiff(zip_map$zip_code, zori_wide$zip_code) %>% head(10)
```

    ##  [1] "10464" "10474" "10475" "10499" "10550" "10704" "10705" "10803" "11202"
    ## [10] "11224"

``` r
tidy_df <- tidy_df %>%
  mutate(rent_index = suppressWarnings(as.numeric(rent_index)))

jan_wide <- tidy_df %>%
  filter(month == 1, year %in% c(2020, 2021)) %>%
  group_by(zip_code, neighborhood, year) %>%
  summarise(rent_index = mean(rent_index, na.rm = TRUE), .groups = "drop") %>%
  tidyr::pivot_wider(
    names_from  = year,
    values_from = rent_index,
    names_prefix = "y"
  ) %>%
  mutate(across(starts_with("y"), ~ suppressWarnings(as.numeric(.)))) %>%
  filter(!is.na(y2020) & !is.na(y2021))

top_drops <- jan_wide %>%
  mutate(diff = y2021 - y2020) %>%
  arrange(diff) %>%
  slice_head(n = 10) %>%
  select(zip_code, neighborhood, diff)

top_drops
```

    ## # A tibble: 10 × 3
    ##    zip_code neighborhood                   diff
    ##    <chr>    <chr>                         <dbl>
    ##  1 10007    Lower Manhattan               -913.
    ##  2 10069    <NA>                          -748.
    ##  3 10009    Lower East Side               -714.
    ##  4 10016    Gramercy Park and Murray Hill -712.
    ##  5 10001    Chelsea and Clinton           -710.
    ##  6 10002    Lower East Side               -710.
    ##  7 10004    Lower Manhattan               -706.
    ##  8 10038    Lower Manhattan               -698.
    ##  9 10012    Greenwich Village and Soho    -686.
    ## 10 10010    Gramercy Park and Murray Hill -685.
